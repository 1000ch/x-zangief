<template id="x-zangief-template">
  <img>
</template>
<script>
  (function () {
    var doc = document.currentScript.ownerDocument;
    var root = new URL(doc.baseURI);

    var ZANGIEF_TYPES = {
      combo: 'zangief-combo.gif',
      fail: 'zangief-fail.gif',
      rolling: 'zangief-rolling.gif',
      piledriver: 'zangief-piledriver.gif',
      win: 'zangief-win.gif'
    };

    function getRandomType() {

      var types = Object.keys(ZANGIEF_TYPES);
      var index = Math.floor(Math.random() * types.length);
      return types[index];
    }

    var XZangiefPrototype = Object.create(HTMLElement.prototype);

    XZangiefPrototype.validateType = function () {

      var types = Object.keys(ZANGIEF_TYPES);
      if (types.indexOf(this.zangiefType) === -1) {
        this.zangiefType = getRandomType();
      }
    };

    XZangiefPrototype.getImagePath = function () {

      var imageUrl = new URL('img/' + ZANGIEF_TYPES[this.zangiefType], root);
      return imageUrl.href;
    };

    XZangiefPrototype.createdCallback = function () {

      this.zangiefType = this.getAttribute('type');
      this.validateType();

      this.shadowRoot = this.createShadowRoot();
      this.template = doc.querySelector('#x-zangief-template');
      this.shadowRoot.appendChild(document.importNode(this.template.content, true));
      this.shadowRoot.querySelector('img').src = this.getImagePath();
    };

    XZangiefPrototype.attributeChangedCallback = function (attributeName, oldValue, newValue) {

      if (attributeName === 'type') {
        this.zangiefType = newValue;
        this.validateType();

        this.shadowRoot.querySelector('img').src = this.getImagePath();
      }
    };

    window.XZangief = document.registerElement('x-zangief', {
      prototype: XZangiefPrototype
    });
  })();
</script>